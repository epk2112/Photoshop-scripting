var roll=function(){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};function t(t,r){function o(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}var r=function(){return(r=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(r[o[i]]=e[o[i]])}return r}function i(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,i,n=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(e){i={error:e}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return s}function n(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e}var s,a=function(){function e(){this.data={},this.length=0}return e.prototype.clear=function(){this.data={},this.length=0},e.prototype.getItem=function(e){var t=this.data[e];return t||null},e.prototype.removeItem=function(e){return!!this.data[e]&&(delete this.data[e],--this.length,!0)},e.prototype.setItem=function(e,t){this.data[e]||++this.length,this.data[e]=t},e.prototype.key=function(e){throw new Error("Method not implemented. "+e)},e}();!function(e){e.LocalStorage="local",e.SessionStorage="session",e.MemoryStorage="memory"}(s||(s={}));var c,u="Authorization",l=new(function(){function e(){var e=this;this.logEnabled=!1,this.print=function(t,r){e.logEnabled&&t.apply(void 0,n(r))},this.assert=function(t,r){e.print(console.assert,[t,r])},this.assertCondition=function(t,r){t()||e.print(console.error,[r])},this.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.error,t)},this.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.warn,t)},this.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.print(console.info,t)}}return e.prototype.enableLogging=function(){this.logEnabled=!0},e.prototype.disableLogging=function(){this.logEnabled=!1},e}()),d=new(function(){function e(){this.memoryStorageInstance=null}return Object.defineProperty(e.prototype,"memoryStorage",{get:function(){return this.memoryStorageInstance||(this.memoryStorageInstance=new a),this.memoryStorageInstance},enumerable:!0,configurable:!0}),e.prototype.getStorageByName=function(e){var t=this.getStorageInstanceByName(e);return t&&this.verifyStorage(t)?t:this.memoryStorage},e.prototype.getStorageInstanceByName=function(e){if(e===s.MemoryStorage)return this.memoryStorage;try{return e===s.LocalStorage?window.localStorage:window.sessionStorage}catch(e){return l.warn("Please change your cookies settings in order to allow local data to be set"),null}},e.prototype.getAvailableStorage=function(){var e=this.getStorageByName(s.LocalStorage);return e instanceof a?this.getStorageByName(s.SessionStorage):e},e.prototype.verifyStorage=function(e){try{return e.setItem("test","true"),"true"===e.getItem("test")&&(e.removeItem("test"),!0)}catch(e){return!1}},e}()),p=function(){function e(e){this.storageInstance=null,this.nonceStorageKey="",this.nonceStorageKey="nonce"+e}return Object.defineProperty(e.prototype,"storage",{get:function(){return this.storageInstance||(this.storageInstance=d.getAvailableStorage()),this.storageInstance},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){if(!this.isStorageAvailable())return"";var t=e.generateNonce(),r=this.getNonceFromStorage()||{};return r=this.clearOlderNonceKeys(r),this.addNonceToObject(r,t),this.saveNonceValuesToStorage(r),t.value},e.prototype.addNonceToObject=function(e,t){e[t.value]=t.expiry},e.prototype.clearOlderNonceKeys=function(e,t){void 0===t&&(t=1296e4);var r=Date.now()-t;return Object.keys(e).forEach((function(t){parseInt(e[t])<r&&delete e[t]})),e},e.prototype.verify=function(e){if(!this.isStorageAvailable())return!0;var t=this.getNonceFromStorage();if(!t)return!1;var r=this.clearOlderNonceKeys(t),o=null!==(r[e]||null);return o&&this.clearNonceValueFromStorage(r,e),o},e.prototype.clearNonceValueFromStorage=function(e,t){delete e[t],this.saveNonceValuesToStorage(e)},e.prototype.getNonceFromStorage=function(){var e=this.storage.getItem(this.nonceStorageKey);return e?JSON.parse(e):null},e.prototype.saveNonceValuesToStorage=function(e){this.storage.setItem(this.nonceStorageKey,JSON.stringify(e))},e.prototype.isStorageAvailable=function(){return!(this.storage instanceof a)},e.cryptoRndomString=function(){if(!window.crypto)return"";var e=new Uint32Array(3);return window.crypto.getRandomValues(e),e.join("").substr(0,16)},e.randomString=function(){var t=e.cryptoRndomString();if(t)return t;for(var r="",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<16;i++)r+=o.charAt(Math.floor(Math.random()*o.length));return r},e.generateNonce=function(){return{value:e.randomString(),expiry:(new Date).getTime().toString()}},e}(),h=new(function(){function e(){}return e.prototype.uriEncodeData=function(e){if("object"!=typeof e)return"";var t,r=[],o="";for(var i in e)void 0!==(t=e[i])&&(o=this.encodeValue(t),r.push(encodeURIComponent(i)+"="+o));return r.join("&")},e.prototype.encodeValue=function(e){return null===e?"null":"object"==typeof e?encodeURIComponent(JSON.stringify(e)):encodeURIComponent(e)},e.prototype.replaceUrl=function(e){e&&window.location.replace(e)},e.prototype.setHrefUrl=function(e){e&&(window.location.href=e)},e.prototype.setHash=function(e){void 0===e&&(e=""),window.location.hash=e},e}());!function(e){e.STAGE="stg1",e.PROD="prod"}(c||(c={}));var f=new(function(){function e(){this.baseUrlAdobe="",this.baseUrlServices="",this.jslibver="v2-v0.22.0-4-gdca321d"}return e.prototype.loadEnvironment=function(e){if(e===c.STAGE)return this.baseUrlAdobe="https://ims-na1-stg1.adobelogin.com",void(this.baseUrlServices="https://adobeid-na1-stg1.services.adobe.com");this.baseUrlAdobe="https://ims-na1.adobelogin.com",this.baseUrlServices="https://adobeid-na1.services.adobe.com"},e}());function v(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}function m(e,t){if(null==e)return t;if(e===t)return e;if(!v(e))return e;var r=Object.assign({},e);return v(t)&&Object.keys(t).forEach((function(o){var i,n;v(t[o])?o in e?r[o]=m(e[o],t[o]):Object.assign(r,((i={})[o]=t[o],i)):Object.assign(r,((n={})[o]=t[o],n))})),r}var g,y,k=new(function(){function e(){this.getCustomApiParameters=function(e,t){return e[t]||{}}}return e.prototype.mergeExternalParameters=function(e,t,r){return m(this.getCustomApiParameters(t,r),e)},e.prototype.toJson=function(e){try{return"string"!=typeof e?e:JSON.parse(e)}catch(e){return null}},e}()),w=function(){function e(){}return e.getInitialRedirectUri=function(e,t){var r=e.redirect_uri||t||window.location.href,o=r.indexOf("from_ims");return-1===o?r:("#"===r[o-1]&&o--,r.substr(0,o))},e.createDefaultRedirectUrl=function(e,t,r,o){var i=this.getInitialRedirectUri(r,e),n=this.createOldHash(i);return n.indexOf("?")>0?n+"&client_id="+t+"&api="+o:n+"?client_id="+t+"&api="+o},e.createRedirectUrl=function(e,t,r,o,i){void 0===i&&(i="");var n=this.createDefaultRedirectUrl(e,t,r,o);(i=i||r.scope||"")&&(n=n+"&scope="+i);var s=r.reauth||"";return s&&(n=n+"&reauth="+s),n},e.createOldHash=function(e){var t=e.indexOf("#");return t<0?e+"#old_hash=&from_ims=true":e.substring(0,t)+"#old_hash="+e.substring(t+1)+"&from_ims=true"},e.mergeApiParamsWithExternalParams=function(e,t,r){return m(k.getCustomApiParameters(e,r),t)},e}(),S=function(){var e=this;this.composeRedirectUrl=function(e){var t=e.apiParameters,o=e.externalParameters,i=void 0===o?{}:o,n=e.adobeIdRedirectUri,s=void 0===n?"":n,a=e.clientId,c=e.locale,u=e.state,l=void 0===u?{}:u,d=e.scope,p=void 0===d?i.scope||t.scope||"":d,h=w.mergeApiParamsWithExternalParams(t,i,"authorize");l&&(h.state=m(h.state||{},l));var v=w.createRedirectUrl(s,a,h,"authorize",p),g=i.locale||c||"",y=e.response_type,k=void 0===y?h.response_type||"":y;return r(r({},h),{client_id:a,scope:p,locale:g,response_type:k,jslVersion:f.jslibver,redirect_uri:v})},this.createRedirectUrl=function(t){var r=e.composeRedirectUrl(t),o=h.uriEncodeData(r);return f.baseUrlAdobe+"/ims/authorize/v1?"+o}},b=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.signIn=function(e){var r=t.createRedirectUrl(e);h.setHrefUrl(r)},t.authorizeToken=function(e,r){var o=t.composeRedirectUrl(r);e&&(o.user_assertion=e,o.user_assertion_type="urn:ietf:params:oauth:client-assertion-type:jwt-bearer"),t.createAuthorizeForm(o).submit()},t}return t(r,e),r.prototype.createAuthorizeForm=function(e){var t=f.baseUrlAdobe+"/ims/authorize/v1",r=document.createElement("form");r.setAttribute("method","post"),r.setAttribute("action",t);var o=null,i=null,n="";for(var s in e){if("object"==typeof(i=e[s])){if(0===Object.keys(i).length)continue;n=JSON.stringify(i)}else n=i;""!==n&&(o=this.createFormElement("input","text",s,n),r.appendChild(o))}return document.getElementsByTagName("body")[0].appendChild(r),r},r.prototype.createFormElement=function(e,t,r,o){var i=document.createElement(e);return i.setAttribute("type",t),i.setAttribute("name",r),i.setAttribute("value",o),i},r}(S),_=new function(){var e=this;this.windowObjectReference=null,this.previousUrl="",this.openSignInWindow=function(t,r,o,i){e.onProcessLocation=i,e.timerId&&clearInterval(e.timerId),window.removeEventListener("message",e.receiveMessage),window.addEventListener("message",e.receiveMessage);var n="toolbar=no, menubar=no, width="+o.width+", height="+o.height+", top="+o.top+", left="+o.left;!e.windowObjectReference||e.windowObjectReference&&e.windowObjectReference.closed?e.windowObjectReference=window.open(t,o.title,n):e.previousUrl!==t?(e.windowObjectReference=window.open(t,o.title,n),e.windowObjectReference&&e.windowObjectReference.focus()):e.windowObjectReference.focus();var s=e.windowObjectReference||{};s.opener||(e.timerId=setInterval((function(){s[r]&&(clearInterval(e.timerId),e.onProcessLocation&&e.onProcessLocation(s[r]),delete s[r],e.windowObjectReference&&e.windowObjectReference.close())}),500)),e.previousUrl=t},this.receiveMessage=function(t){e.onProcessLocation&&e.onProcessLocation(t.data)}},I=function(e){function o(t,o){var i=e.call(this)||this;return i.signIn=function(e){e.state=r(r({},e.state),{imslibmodal:!0});var t=e.state.nonce,o=i.createRedirectUrl(e);_.openSignInWindow(o,t,i.popupSettings,i.onPopupMessage)},i.onPopupMessage=t,i.popupSettings=o,i}return t(o,e),o}(S),P=function(){this.signOut=function(e){var t=e.apiParameters,o=e.externalParameters,i=e.adobeIdRedirectUri,n=void 0===i?"":i,s=e.clientId,a=w.mergeApiParamsWithExternalParams(t,o,"logout"),c=w.createDefaultRedirectUrl(n,s,a,"logout"),u=r(r({},a),{client_id:s,redirect_uri:c,jslVersion:f.jslibver}),l=h.uriEncodeData(u),d=f.baseUrlAdobe+"/ims/logout/v1?"+l;h.replaceUrl(d)}},R=function(e){void 0===e&&(e={}),this.title="Adobe ID",this.width=600,this.top=100,this.left=100;var t=e.title,r=void 0===t?"Adobe ID":t,o=e.width,i=void 0===o?600:o,n=e.height,s=void 0===n?700:n,a=e.top,c=void 0===a?100:a,u=e.left,l=void 0===u?100:u;this.title=r,this.width=i,this.height=s,this.top=c,this.left=l},T=function(e){this.token="",this.sid="",this.expirems=0;var t=e.token,r=e.expirems;this.token=t,this.expirems=r};!function(e){e.force="force",e.check="check"}(g||(g={})),function(e){e.token="token",e.code="code"}(y||(y={}));var A,E=function(){this.appCode="",this.appVersion=""},j=function(){function e(){this.storage=d.getAvailableStorage()}return e.prototype.b64Uri=function(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},e.prototype.createCodeChallenge=function(e,t){var r=this;void 0===t&&(t=43);for(var o=window.msCrypto||window.crypto,i=this.b64Uri(Array.prototype.map.call(o.getRandomValues(new Uint8Array(t)),(function(e){return String.fromCharCode(e)})).join("")).substring(0,t),s=new Uint8Array(i.length),a=0;a<i.length;a++)s[a]=i.charCodeAt(a);var c=o.subtle.digest("SHA-256",s);return new Promise((function(t,o){window.CryptoOperation?(c.onerror=function(e){return o(e)},c.oncomplete=function(o){var s=new Uint8Array(o.target.result),a=r.b64Uri(String.fromCharCode.apply(String,n(s)));return t(r.saveVerifierAndReturn(e,{verifier:i,challenge:a}))}):c.then((function(o){var s=new Uint8Array(o),a=r.b64Uri(String.fromCharCode.apply(String,n(s)));return t(r.saveVerifierAndReturn(e,{verifier:i,challenge:a}))}))}))},e.prototype.saveVerifierAndReturn=function(e,t){var r=this.getVerifierValuesFromStorage(),o={verifier:t.verifier||"",expiry:(new Date).getTime().toString()};return r[e]=o,this.storage.setItem("verifiers",JSON.stringify(r)),Promise.resolve(t)},e.prototype.getVerifierValuesFromStorage=function(){var e=this.storage.getItem("verifiers"),t=e?JSON.parse(e):{};return this.clearOlderVerifiers(t)},e.prototype.clearOlderVerifiers=function(e,t){void 0===t&&(t=1296e4);var r=Date.now()-t;return Object.keys(e).forEach((function(t){parseInt(e[t])<r&&delete e[t]})),e},e.prototype.getVerifierByKey=function(e){var t=this.getVerifierValuesFromStorage(),r=t?t[e]:{};return delete t[e],this.storage.setItem("verifiers",JSON.stringify(t)),r?r.verifier:""},e}(),O=function(e){function o(t){void 0===t&&(t=null);var r=e.call(this,t)||this;r.onAccessTokenHasExpired=null,r.onAccessToken=null,r.onReauthAccessToken=null,r.onError=null,r.handlers={triggerOnAccessToken:function(e){r.onAccessToken&&r.onAccessToken(e)},triggerOnReauthAccessToken:function(e){r.onReauthAccessToken&&r.onReauthAccessToken(e)},triggerOnAccessTokenHasExpired:function(){r.onAccessTokenHasExpired&&r.onAccessTokenHasExpired()},triggerOnReady:function(e){void 0===e&&(e=null),r.onReady&&r.onReady(e)},triggerOnError:function(e,t){r.onError&&r.onError(e,t)}};var o=t||window.adobeid;if(!o)throw new Error("Please provide adobeId information");var i=o.standalone,n=o.autoValidateToken,s=o.modalSettings,a=void 0===s?{}:s,c=o.modalMode,u=void 0!==c&&c,l=o.onAccessToken,d=o.onReauthAccessToken,p=o.onAccessTokenHasExpired,h=o.onReady,f=o.onError;return i&&i.token&&(r.standalone=new T(i)),r.modalSettings=new R(a),r.modalMode=u,r.autoValidateToken=!!n,r.onAccessToken=l||null,r.onReauthAccessToken=d||null,r.onAccessTokenHasExpired=p||null,r.onReady=h||null,r.onError=f||null,r}return t(o,e),o.prototype.createSocialProviderRedirectRequest=function(e,t,o,i,n){void 0===n&&(n=y.token);var s={idp_flow:"social.deep_link.web",provider_id:e},a=r(r({},t),s);return this.createRedirectRequest(a,o,i,n)},o.prototype.createReAuthenticateRedirectRequest=function(e,t,o,i,n){void 0===i&&(i=g.check),void 0===n&&(n=y.token);var s={reauth:i},a=r(r({},e),s);return this.createRedirectRequest(a,t,o,n)},o.prototype.createSignUpRedirectRequest=function(e,t,o,i){void 0===i&&(i=y.token);var n=r(r({},e),{idp_flow:"create_account"});return this.createRedirectRequest(n,t,o,i)},o}(function(){function e(e){void 0===e&&(e=null),this.analyticsParameters=new E,this.api_parameters={},this.locale="",this.scope="AdobeID",this.client_id="",this.environment=c.PROD,this.useLocalStorage=!1,this.onReady=null;var t=e||window.adobeid;if(!t)throw new Error("Please provide adobeId information");var r=t.api_parameters,o=t.client_id,i=t.locale,n=t.scope,s=t.ijt,a=t.environment,u=void 0===a?c.PROD:a,d=t.redirect_uri,p=t.useLocalStorage,h=t.logsEnabled,v=t.onReady;this.environment=u,this.api_parameters=r||{},this.client_id=o,this.locale=i||"en_US",this.scope=n?n.replace(/\s/gi,""):"",this.redirect_uri=d,this.ijt=s,this.useLocalStorage=p,h?l.enableLogging():l.disableLogging(),this.onReady=v||null,this.fillAnalityticsParameters(t),f.loadEnvironment(u)}return e.prototype.fillAnalityticsParameters=function(e){var t=e.analytics,r=void 0===t?{}:t,o=r.appCode,i=void 0===o?"":o,n=r.appVersion,s=void 0===n?"":n,a=this.analyticsParameters;a.appCode=i,a.appVersion=s},e.prototype.createSocialProviderRedirectRequest=function(e,t,o,i,n){var s={idp_flow:"social.deep_link.web",provider_id:e},a=r(r({},t),s);return this.createRedirectRequest(a,o,i,n)},e.prototype.createReAuthenticateRedirectRequest=function(e,t,o,i,n){void 0===i&&(i=g.check),void 0===n&&(n=y.token);var s={reauth:i},a=r(r({},e),s);return this.createRedirectRequest(a,t,o,n)},e.prototype.createSignUpRedirectRequest=function(e,t,o){var i=r(r({},e),{idp_flow:"create_account"});return this.createRedirectRequest(i,t,o,y.token)},e.prototype.createRedirectRequest=function(e,t,r,o){var i=this,n=this,s=n.api_parameters,a=void 0===s?{}:s,c=n.client_id,u=n.redirect_uri,l=void 0===u?"":u,d=n.scope,p=n.locale,h=this.createRedirectState(t,r),f={adobeIdRedirectUri:l,apiParameters:a,clientId:c,externalParameters:e,scope:d,locale:p,response_type:o,state:h};return o===y.token?Promise.resolve(f):(new j).createCodeChallenge(r).then((function(o){e.code_challenge=o.challenge,e.code_challenge_method="S256";var n=i.createRedirectState(t,r);return f.state=n,Promise.resolve(f)}))},e.prototype.createRedirectState=function(e,t){var r=this.analyticsParameters,o=r.appCode,i=void 0===o?"":o,n=r.appVersion,s=void 0===n?"":n,a=void 0===e?{}:{context:e};return i&&(a.ac=i),s&&(a.av=s),a.jslibver=f.jslibver,a.nonce=t,Object.keys(a).length?a:null},e.prototype.triggerOnReady=function(){this.onReady&&this.onReady(void 0)},e}()),x=new(function(){function e(){var e=this;this.DEBOUNCE_TIME=1e3,this.cache={},this.storeApiResponse=function(t,r,o){void 0===t&&(t=""),void 0===r&&(r=""),e.cacheApiResponse(t,r,o)}}return e.prototype.getCachedApiResponse=function(e,t){void 0===t&&(t="");var r="string"==typeof t?t:JSON.stringify(t),o=this.cache[e];if(!o)return null;var i=o[r];return i?i.data:null},e.prototype.cacheApiResponse=function(e,t,o){void 0===e&&(e=""),void 0===t&&(t="");var i=this.cache[e];i||(i={},this.cache[e]=i);var n=this.createClearCachedDataTimer(e,t);i[t]={timerId:n,data:r({},o)}},e.prototype.createClearCachedDataTimer=function(e,t){var r=this;return setTimeout((function(){var o=r.cache[e]||{},i=o[t];i&&i&&i.timerId&&(clearTimeout(i.timerId),delete o[t])}),this.DEBOUNCE_TIME)},e}()),U=function(e,t){this.jump="",this.code=e,this.jump=t},D=function(e){var t=e.error,r=e.retryAfter,o=void 0===r?0:r,i=e.message,n=void 0===i?"":i;this.error=t,this.retryAfter=o,this.message=n},F=new(function(){function e(){}return e.prototype.verify=function(e){var t=e.status,r=e.data;if(!t)return new D({error:"networkError",message:r||""});if(401==t)return new D({error:"unauthorized"});var o=this.parseTokenResponseForRideErrors(r);return o||(409==t?r:429==t?new D({error:"rate_limited",retryAfter:r.retryAfter?parseInt(r.retryAfter):10}):t.toString().match(/5\d{2}/g)?new D({error:"server_error"}):null)},e.prototype.parseTokenResponseForRideErrors=function(e){if(!e)return null;var t=e.error,r=e.jump;return t&&0===t.indexOf("ride_")?new U(t,r||""):null},e.prototype.isUnauthorizedException=function(e){var t=e.status;return 401===(void 0===t?0:t)},e}()),C=function(){function e(e,t){this.status=0,this.data="",this.status=e,this.data=this.toJson(t)}return e.prototype.toJson=function(e){try{return"string"!=typeof e?e:JSON.parse(e)}catch(t){return e}},e}(),N=new(function(){function e(){}return e.prototype.http=function(e){return new Promise((function(t,r){var o=new(0,window.XMLHttpRequest);o.withCredentials=!0,o.open(e.method,e.url,!0);var i;o.onload=function(){return this.status>=200&&this.status<300?t(new C(this.status,this.response)):r(new C(this.status,this.response))},o.onerror=function(){var e=new C(this.status,this.response);return r(e)},(i=e.headers)&&Object.keys(i).forEach((function(e){o.setRequestHeader(e,i[e])})),o.send(e.data)}))},e.prototype.post=function(e,t,r){return void 0===r&&(r={}),this.http({headers:r,method:"POST",url:e,data:t})},e.prototype.get=function(e,t){return void 0===t&&(t={}),this.http({headers:t,method:"GET",url:e})},e}()),V=new(function(){function e(){this.triggerOnError=null}return e.prototype.post=function(e,t,r){var o=this;void 0===r&&(r={});var i=x.getCachedApiResponse(e,t);if(i){var n=i.status,s=i.data;return 200===n?Promise.resolve(s):Promise.reject(s)}return N.post(e,t,r).then((function(r){return o.storeApiResponse(e,JSON.stringify(t),r)})).catch((function(r){return o.verifyError(e,JSON.stringify(t),r)}))},e.prototype.get=function(e,t){var r=this;void 0===t&&(t={});var o=x.getCachedApiResponse(e);if(o){var i=o.status,n=o.data;return 200===i?Promise.resolve(n):Promise.reject(n)}return N.get(e,t).then((function(t){return r.storeApiResponse(e,"",t)})).catch((function(t){return r.verifyError(e,"",t)}))},e.prototype.verifyError=function(e,t,r){this.storeApiResponse(e,t,r);var o=F.verify(r);return Promise.reject(o||r.data)},e.prototype.storeApiResponse=function(e,t,r){return void 0===t&&(t=""),x.storeApiResponse(e,t,r),Promise.resolve(r.data)},e}()),z=function(){function e(e){void 0===e&&(e={}),this.CONTENT_FORM_ENCODED="application/x-www-form-urlencoded;charset=utf-8",this.apiParameters=e}return e.prototype.validateToken=function(e){var t=e.token,o=e.client_id,i=h.uriEncodeData(r(r({},k.getCustomApiParameters(this.apiParameters,"validate_token")),{type:"access_token",client_id:o,token:t})),n=f.baseUrlAdobe+"/ims/validate_token/v1?jslVersion="+f.jslibver;return V.post(n,i,this.formEncoded())},e.prototype.getProfile=function(e){var t=e.token,o=e.client_id,i=r({},k.getCustomApiParameters(this.apiParameters,"profile")),n=this.createAuthorizationHeader(t),s=h.uriEncodeData(r({client_id:o},i)),a=f.baseUrlAdobe+"/ims/profile/v1?"+s+"&jslVersion="+f.jslibver;return V.get(a,n)},e.prototype.getUserInfo=function(e){var t=e.token,o=e.client_id,i=r({},k.getCustomApiParameters(this.apiParameters,"userinfo")),n=this.createAuthorizationHeader(t),s=h.uriEncodeData(r({client_id:o},i)),a=f.baseUrlAdobe+"/ims/userinfo/v1?"+s+"&jslVersion="+f.jslibver;return V.get(a,n)},e.prototype.logoutToken=function(e){var t=e.client_id,o=e.token,i=r({},k.getCustomApiParameters(this.apiParameters,"logout_token")),n=f.baseUrlServices+"/ims/logout/v1?jslVersion="+f.jslibver;return V.post(n,r({client_id:t,access_token:o},i))},e.prototype.checkStatus=function(){var e=f.baseUrlServices+"/ims/check/v1/status";return V.get(e)},e.prototype.checkToken=function(e,t,o){var i=e.client_id,n=e.scope,s=r({},k.mergeExternalParameters(t,this.apiParameters,"check_token")),a=f.baseUrlServices+"/ims/check/v6/token?jslVersion="+f.jslibver,c=r(r({},s),{client_id:i,scope:n});o&&(c.user_id=o);var u=h.uriEncodeData(c);return V.post(a,u,this.formEncoded())},e.prototype.switchProfile=function(e,t,o){void 0===o&&(o="");var i=e.client_id,n=e.scope,s=void 0===n?"":n,a=r({},k.mergeExternalParameters(t,this.apiParameters,"check_token")),c=f.baseUrlServices+"/ims/check/v6/token?jslVersion="+f.jslibver,u=h.uriEncodeData(r(r({},a),{client_id:i,scope:s,user_id:o}));return V.post(c,u,this.formEncoded())},e.prototype.listSocialProviders=function(e){var t=e.client_id,o=r({},k.getCustomApiParameters(this.apiParameters,"providers")),i=h.uriEncodeData(r({client_id:t},o)),n=f.baseUrlServices+"/ims/social/v1/providers?"+i+"&jslVersion="+f.jslibver;return V.get(n)},e.prototype.exchangeIjt=function(e,t){var o=e.client_id,i=r({},k.getCustomApiParameters(this.apiParameters,"ijt")),n=f.baseUrlServices+"/ims/jump/implicit/"+t,s=h.uriEncodeData(r({client_id:o},i)),a=n+"?"+s+"&jslVersion="+f.jslibver;return a.length>2048&&(delete i.redirect_uri,a=n+"?"+(s=h.uriEncodeData(i))),V.get(a)},e.prototype.avatarUrl=function(e){return f.baseUrlAdobe+"/ims/avatar/download/"+e},e.prototype.getReleaseFlags=function(e){var t=e.token,o=e.client_id,i=r({},k.getCustomApiParameters(this.apiParameters,"fg_value")),n=this.createAuthorizationHeader(t),s=h.uriEncodeData(r({client_id:o},i)),a=f.baseUrlAdobe+"/ims/fg/value/v1?"+s+"&jslVersion="+f.jslibver;return V.get(a,n)},e.prototype.getTransitoryAuthorizationCode=function(e,t,o){void 0===t&&(t={});var i=r({},k.mergeExternalParameters(t,this.apiParameters,"check_token")),n=f.baseUrlServices+"/ims/check/v6/token?client_id="+o+"&jslVersion="+f.jslibver,s=h.uriEncodeData(r(r({},i),e));return V.post(n,s,this.formEncoded())},e.prototype.getTokenFromCode=function(e,t){void 0===t&&(t={});var o=r({},k.mergeExternalParameters(t,this.apiParameters,"token"));o.grant_type="authorization_code",delete e.other;var i=f.baseUrlServices+"/ims/token/v3?jslVersion="+f.jslibver,n=h.uriEncodeData(r(r({},o),e));return V.post(i,n,this.formEncoded())},e.prototype.jumpToken=function(e,t,o){void 0===t&&(t={});var i=r({},k.mergeExternalParameters(t,this.apiParameters,"jumptoken")),n=f.baseUrlServices+"/ims/jumptoken/v1?client_id="+o+"&jslVersion="+f.jslibver,s=h.uriEncodeData(r(r({},i),e));return V.post(n,s,this.formEncoded())},e.prototype.createAuthorizationHeader=function(e){var t={};return e&&(t[u]="Bearer "+e),t},e.prototype.formEncoded=function(e){return void 0===e&&(e={}),e["content-type"]=this.CONTENT_FORM_ENCODED,e},e}();!function(e){e.INITIALIZE_ERROR="initialize_error",e.HTTP="http",e.FRAGMENT="fragment",e.CSRF="csrf",e.NOT_AUTHORIZE="not_authorize",e.PROFILE_EXCEPTION="profile_exception",e.TOKEN_EXPIRED="token_expired",e.SOCIAL_PROVIDERS="SOCIAL_PROVIDERS",e.RIDE_EXCEPTION="ride_exception"}(A||(A={}));var L,M=function(e){this.message=null,this.errorType=A.PROFILE_EXCEPTION,this.message=e},H=function(){function e(e){this.profileServiceRequest=e,this.storage=d.getStorageByName(s.SessionStorage)}return e.prototype.getProfile=function(e){var t=this,r=this.profileServiceRequest,o=r.clientId,i=r.imsApis,n=this.getProfileFromStorage();return n?Promise.resolve(n):i.getProfile({client_id:o,token:e}).then((function(e){if(!e)throw new M("NO profile response");if(0===Object.keys(e).length)throw new M("NO profile value");return t.saveProfileToStorage(e),Promise.resolve(e)})).catch((function(e){return e instanceof D?Promise.reject(e):(t.removeProfile(),Promise.reject(e))}))},e.prototype.getProfileStorageKey=function(){var e=this.profileServiceRequest;return"adobeid_ims_profile/"+e.clientId+"/"+!1+"/"+e.scope},e.prototype.getProfileFromStorage=function(){var e=this.getProfileStorageKey(),t=this.storage.getItem(e);return t?JSON.parse(t):null},e.prototype.saveProfileToStorage=function(e){var t=this.getProfileStorageKey();this.storage.setItem(t,JSON.stringify(e))},e.prototype.removeProfile=function(){var e=this.getProfileStorageKey();this.storage.removeItem(e)},e.prototype.removeProfileIfOtherUser=function(e){if(e){var t=this.getProfileFromStorage();t&&t.userId!==e&&this.removeProfile()}},e}(),q=function(){function e(e,t){var r=this;this.REAUTH_SCOPE="reauthenticated",this.valid=!1,this.isReauth=function(){return r.scope.indexOf(r.REAUTH_SCOPE)>=0},this.client_id="",this.scope="",this.expire=new Date,this.user_id="",this.tokenValue="",this.sid="",this.state=null,this.fromFragment=!1,this.impersonatorId="",this.isImpersonatedSession=!1;var o=e.valid,i=e.tokenValue,n=e.access_token,s=e.state,a=e.other,c=i||n,u=this.parseJwt(c);if(!u)throw new Error("token cannot be decoded "+c);this.state=k.toJson(s);var l=u.client_id,d=u.user_id,p=u.scope,h=u.sid,f=u.imp_id,v=u.imp_sid;this.client_id=l,this.expire=t,this.user_id=d,this.scope=p,this.valid=o,this.tokenValue=c,this.sid=h,this.other=a,this.impersonatorId=f||"",this.isImpersonatedSession=!!v}return e.prototype.parseJwt=function(e){if(!e)return null;try{return JSON.parse(atob(e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/")))}catch(t){return l.error("error on decoding token ",e,t),null}},e.prototype.validate=function(e,t){var r=this,o=this.valid,i=this.client_id,n=this.scope,s=this.expire;if(s<new Date)return l.error("token invalid  --\x3e expires_at",s),!1;if(null!=o&&!o)return l.error("token invalid  --\x3e valid"),!1;if(i!==e)return l.error("token invalid  --\x3e client id",i,e),!1;if(this.isReauth()){var a=n.split(",").filter((function(e){return e!==r.REAUTH_SCOPE})).join(",");if(a!==t)return l.error("reauth token invalid  --\x3e scope"," token scope =",a,"vs adobeIdScope =",t,"."),!1}else if(n!==t)return l.error("token invalid  --\x3e scope"," token scope =",n,"vs adobeIdScope =",t,"."),!1;return!0},e}(),J=new(function(){function e(){}return e.prototype.fragmentToObject=function(){var e=this.getHashFromURL();if(!e)return null;var t=this.processHashUrl(e),r=this.getOldHash(t),o=r?t.slice(t.indexOf("old_hash")):t,i=this.removeOldHash(o),n=this.getQueryParamsAsMap(i);r&&(n.old_hash=r);var s=n.state;return s&&(n.state=k.toJson(s)),n},e.prototype.getOldHash=function(e){if(!e)return"";var t=e.match("old_hash=(.*?)&from_ims=true");return t?t[1]:""},e.prototype.removeOldHash=function(e){return e?e.replace(/old_hash=(.*?)&from_ims=true/gi,"from_ims=true"):e},e.prototype.getHashFromURL=function(e){void 0===e&&(e=window.location.href);var t=e.indexOf("#");return-1!==t?e.substring(t+1):""},e.prototype.getQueryParamsAsMap=function(e){if(!e)return{};var t={};return(e=e.replace(/^(#\/|\/|#|\?|&)/,"")).split("&").forEach((function(e){if(e.length){var r=e.split("=");t[r[0]]=decodeURIComponent(r[1])}})),t},e.prototype.processHashUrl=function(e){return e.replace("?error","#error").replace(/#/gi,"&").replace("from_ims=true?","from_ims=true&")},e}()),K=function(e,t){this.message="",this.type="",this.type=e,this.message=t};!function(e){e.FRAGMENT="fragment",e.CSRF="csrf",e.NOT_AUTHORIZE="not_authorize"}(L||(L={}));var B=function(e,t){this.profile=null,this.tokenFields=e,this.profile=t},G=function(e){this.exception=null,this.exception=e},W=function(e){this.client_id="",this.scope="",this.code="",this.state=null,this.code_verifier="",this.other=null;var t=e.code,r=e.state,i=e.client_id,n=e.scope,s=e.verifier,a=o(e,["code","state","client_id","scope","verifier"]);this.state=r,this.client_id=i,this.code=t,this.scope=n,this.code_verifier=s,this.other=a},X=function(e){this.wndRedirectPropName="",this.wndRedirectPropName=e},Z=function(){function e(e,t){var r=this;this.getTokenAndProfile=function(e){void 0===e&&(e={});var t=r.getTokenFields();return t instanceof X?Promise.reject(t):t instanceof K?Promise.reject(t):t instanceof W?r.tokenServiceRequest.imsApis.getTokenFromCode(t,e).then((function(e){var r=e.access_token,i=e.state,n=e.expires_in,s=e.scope,a=void 0===s?"":s,c=o(e,["access_token","state","expires_in","scope"]),u=new q({scope:a,tokenValue:r,valid:!0,state:i,other:t.other},new Date((new Date).getTime()+parseFloat(n)));return Promise.resolve(new B(u,c))})):t instanceof q?t.fromFragment||!r.tokenServiceRequest.autoValidateToken?Promise.resolve(new B(t,null)):r.callValidateTokenApi(t.tokenValue).then((function(){return new B(t,null)})).catch((function(){return r.callRefreshToken(e)})):r.callRefreshToken(e)};var i=e.useLocalStorage;this.csrfService=t,this.tokenServiceRequest=e,this.storage=d.getStorageByName(i?s.LocalStorage:s.SessionStorage)}return e.prototype.getTokenFields=function(){var e=this.tokenServiceRequest,t=e.clientId,r=e.scope,o=this.getTokenFromFragment();return o instanceof X?o:o instanceof K?o:o instanceof W?o:o&&o.validate(t,r)?(o.fromFragment=!0,this.addTokenToStorage(o),o):this.getTokenFieldsFromStorage()},e.prototype.validateToken=function(){var e=this.getTokenFieldsFromStorage();return e?this.callValidateTokenApi(e.tokenValue):Promise.reject(null)},e.prototype.getReleaseFlags=function(){var e=this.tokenServiceRequest,t=e.clientId,r=e.imsApis,o=this.getTokenFieldsFromStorage();return o?r.getReleaseFlags({token:o.tokenValue,client_id:t}):Promise.reject(null)},e.prototype.callValidateTokenApi=function(e){var t=this,o=this.tokenServiceRequest,i=o.clientId,n=o.scope;return o.imsApis.validateToken({client_id:i,token:e}).then((function(o){l.info("validateToken response",o);var s=new q(r(r({},o),{tokenValue:e}),new Date(parseFloat(o.expires_at)));if(s.validate(i,n))return t.addTokenToStorage(s),Promise.resolve(s);throw new Error("could not validate tokenFields")})).catch((function(e){return l.error("validateToken response",e),e instanceof D?Promise.reject(e):(t.removeTokenFromLocalStorage(),Promise.reject(e))}))},e.prototype.getTokenFromFragment=function(){var e=J.fragmentToObject();if(!e)return null;l.info("fragment value "+e);var t=e.access_token,i=e.scope,n=e.error,s=e.api,a=e.state,c=void 0===a?{}:a,u=e.expires_in,d=e.client_id,p=e.code,h=void 0===p?"":p,f=o(e,["access_token","scope","error","api","state","expires_in","client_id","code"]),v=c.imslibmodal,m=c.nonce;if(!0===v)return new X(m);if(!e.from_ims)return null;if(d!==this.tokenServiceRequest.clientId)return null;if(n)return new K(L.FRAGMENT,n);if("authorize"!==s)return new K(L.NOT_AUTHORIZE,"api should be authorize and "+s+" is used");if(!this.csrfService.verify(m))return new K(L.CSRF,"CSRF exception");if(h){var g=(new j).getVerifierByKey(m);if(!g)throw new Error("no verifier value has been found");return new W(r(r({},e),{verifier:g}))}return t?new q({scope:i,tokenValue:t,valid:!0,state:c,other:f},new Date((new Date).getTime()+parseFloat(u))):null},e.prototype.getStorageKeyValue=function(e){return this.storage.getItem(e)},e.prototype.getTokenFieldsFromStorage=function(e){void 0===e&&(e=!1);var t=this.tokenServiceRequest,r=t.clientId,o=t.scope,i=this.getAccessTokenKey(e),n=this.getStorageKeyValue(i);if(!n)return null;var s=JSON.parse(n),a=s.expire?new Date(Date.parse(s.expire)):new Date(s.expiresAtMilliseconds),c=new q(s,a);return c.validate(r,o)?c:null},e.prototype.getAccessTokenKey=function(e){void 0===e&&(e=!1);var t=this.tokenServiceRequest;return"adobeid_ims_access_token/"+t.clientId+"/"+e+"/"+t.scope},e.prototype.addTokenToStorage=function(e){if(e){var t=e.isReauth(),o=this.getAccessTokenKey(t),i=r({},e);i.state={},i.other="{}",this.storage.setItem(o,JSON.stringify(i))}},e.prototype.removeTokenFromLocalStorage=function(){var e=this.getAccessTokenKey();this.storage.removeItem(e)},e.prototype.removeReauthTokenFromLocalStorage=function(){var e=this.getAccessTokenKey(!0);this.storage.removeItem(e)},e.prototype.refreshToken=function(e){var t=this;void 0===e&&(e={});var i=this.tokenServiceRequest,n=i.clientId,s=i.imsApis,a=i.scope,c=this.getTokenFieldsFromStorage(),u=c?c.user_id:"";return s.checkToken({client_id:n,scope:a},e,u).then((function(e){if(!e)throw new Error("refresh token --\x3e no response");var i=e.access_token,n=e.expires_in,s=e.token_type,a=e.error,c=e.error_description,u=void 0===c?"":c,l=e.sid,d=o(e,["access_token","expires_in","token_type","error","error_description","sid"]);if(a)throw new Error(a+" "+u);var p=Object.keys(d).length?d:null,h={token:i,expire:new Date(Date.now()+parseFloat(n)),token_type:s,sid:l},f=t.updateToken(h)||{},v={tokenInfo:r(r({},h),{impersonatorId:f.impersonatorId||"",isImpersonatedSession:f.isImpersonatedSession||!1}),profile:p};return Promise.resolve(v)})).catch((function(e){return void 0===e&&(e={}),e instanceof D?Promise.reject(e):e instanceof U?Promise.reject(e):(t.removeTokenFromLocalStorage(),Promise.reject(new G(e)))}))},e.prototype.switchProfile=function(e,t){var i=this;void 0===t&&(t={});var n=this.tokenServiceRequest,s=n.clientId,a=n.imsApis,c=n.scope;return a.switchProfile({client_id:s,scope:c},t,e).then((function(e){if(!e)throw new Error("refresh token --\x3e no response");var t=e.access_token,n=e.expires_in,s=e.token_type,a=e.error,c=e.error_description,u=void 0===c?"":c,l=e.sid,d=o(e,["access_token","expires_in","token_type","error","error_description","sid"]);if(a)throw new Error(a+" "+u);var p=Object.keys(d).length?d:null,h={token:t,expire:new Date(Date.now()+parseFloat(n)),token_type:s,sid:l},f=i.updateToken(h)||{},v={tokenInfo:r(r({},h),{impersonatorId:f.impersonatorId||"",isImpersonatedSession:f.isImpersonatedSession||!1}),profile:p};return Promise.resolve(v)})).catch((function(e){return void 0===e&&(e={}),Promise.reject(e)}))},e.prototype.callRefreshToken=function(e){return void 0===e&&(e={}),this.refreshToken(e).then((function(e){var t=e.tokenInfo,r=t.token,o=t.expire,i=e.profile,n=new q({valid:!0,tokenValue:r},o),s=new B(n,i);return Promise.resolve(s)})).catch((function(e){return Promise.reject(e)}))},e.prototype.updateToken=function(e){var t=e.token,r=e.expire,o=new q({tokenValue:t},r);return o?(o.tokenValue=t,this.addTokenToStorage(o),o):null},e.prototype.purge=function(){this.removeTokenFromLocalStorage(),this.removeReauthTokenFromLocalStorage()},e.prototype.setStandAloneToken=function(e){var t=e.token,r=e.sid,o=e.expirems,i=void 0===o?-1:o,n=this.tokenServiceRequest,s=n.clientId,a=n.scope,c=new Date((new Date).getTime()+i);if(!new q({valid:!0,tokenValue:t},c).validate(s,a))return!1;var u={expire:c,token:t,sid:r};return this.updateToken(u),!0},e.prototype.exchangeIjt=function(e){var t=this.tokenServiceRequest,r={client_id:t.clientId,scope:t.scope};return t.imsApis.exchangeIjt(r,e).then((function(e){var t=e.valid,r=e.access_token,o=e.expires_in;if(!1===t)return Promise.reject(e);var i=new Date(Date.now()+parseFloat(o)),n=new q({valid:!0,tokenValue:r},i),s=new B(n,null);return Promise.resolve(s)}))},e}(),Q=["keyup","mousemove"],Y=new(function(){function e(){var e=this;this.userInteractionHandler=function(){var t,r;if((null===(t=e.refreshParameters)||void 0===t?void 0:t.expire)&&e.refreshParameters.refreshTokenMethod&&"in-progress"!==e.refreshState){e.refreshState="in-progress";var o=e.fromNowToNMinutesBeforeDate(null===(r=e.refreshParameters)||void 0===r?void 0:r.expire,1);setTimeout((function(){var t;return null===(t=e.refreshParameters)||void 0===t?void 0:t.refreshTokenMethod()}),o)}},this.initializeDomEvents=function(){Q.forEach((function(t){return window.addEventListener(t,e.userInteractionHandler)}))},this.clearDomEvents=function(){Q.forEach((function(t){return window.removeEventListener(t,e.userInteractionHandler)}))}}return e.prototype.startAutoRefreshFlow=function(e){var t=this;if(e&&e.expire&&e.refreshTokenMethod){this.refreshParameters=e,this.refreshState="idle",this.ignoreUserInteractionTimerId&&clearTimeout(this.ignoreUserInteractionTimerId),this.clearDomEvents();var r=this.fromNowToNMinutesBeforeDate(this.refreshParameters.expire,15);this.ignoreUserInteractionTimerId=setTimeout((function(){t.initializeDomEvents()}),r)}},e.prototype.fromNowToNMinutesBeforeDate=function(e,t){var r=e.getTime()-(new Date).getTime()-6e4*t;return r<0?100:r},e}()),$=function(){function e(e){var t=this;void 0===e&&(e=null),this.initialized=!1,this.onPopupMessage=function(e){return h.replaceUrl(e),t.initialize()},this.signIn=function(e,r,o){void 0===e&&(e={}),void 0===o&&(o=y.token),t.checkInitialized();var i=t,n=i.adobeIdData,s=i.csrfService.initialize();return n.createRedirectRequest(e,r,s,o).then((function(e){t.signInservice.signIn(e)}))},this.authorizeToken=function(e,r,o,i){void 0===e&&(e=""),void 0===r&&(r={}),void 0===i&&(i=y.token);var n=t,s=n.adobeIdData,a=n.csrfService.initialize();return s.createRedirectRequest(r,o,a,i).then((function(t){(new b).authorizeToken(e,t)}))},this.reAuthenticate=function(e,r,o,i){void 0===e&&(e={}),void 0===r&&(r=g.check),void 0===i&&(i=y.token),t.checkInitialized();var n=t,s=n.adobeIdData,a=n.csrfService.initialize();return s.createReAuthenticateRedirectRequest(e,o,a,r,i).then((function(e){t.signInservice.signIn(e)}))},this.signInWithSocialProvider=function(e,r,o,i){if(void 0===r&&(r={}),void 0===i&&(i=y.token),t.checkInitialized(),!e)throw new Error("please provide the provider name");var n=t,s=n.adobeIdData,a=n.csrfService.initialize();s.createSocialProviderRedirectRequest(e,r,o,a,i).then((function(e){t.signInservice.signIn(e)}))},this.signOut=function(e){void 0===e&&(e={}),t.checkInitialized(),t.tokenService.purge(),t.profileService.removeProfile();var r=t.adobeIdData,o=r.api_parameters,i=void 0===o?{}:o,n=r.client_id,s={adobeIdRedirectUri:r.redirect_uri,apiParameters:i,clientId:n,externalParameters:e};(new P).signOut(s)},this.refreshToken=function(e){return void 0===e&&(e={}),t.tokenService.refreshToken(e).then((function(e){return t.onTokenProfileReceived(e)})).catch((function(e){return l.error("refresh token error",e),e instanceof D?Promise.reject(e):e instanceof U?e.jump?(h.replaceUrl(e.jump),Promise.reject(e)):Promise.reject(e):(t.profileService.removeProfile(),t.onTokenExpired(),Promise.reject(e))}))},this.switchProfile=function(e,r){return void 0===r&&(r={}),e?t.tokenService.switchProfile(e,r).then((function(e){return t.onTokenProfileReceived(e)})).catch((function(e){return e instanceof D?Promise.reject(e):e instanceof U&&e.jump?(h.replaceUrl(e.jump),Promise.reject(e)):Promise.reject(e)})):Promise.reject(new Error("Please provide the user id for switchProfile"))},this.triggerOnImsInstance=function(e){var r=document.createEvent("CustomEvent"),o={clientId:t.adobeIdData.client_id,instance:e};r.initCustomEvent("onImsLibInstance",!1,!1,o),window.dispatchEvent(r)},this.processInitializeException=function(e){void 0===e&&(e={});var r=t.adobeIdData.handlers;return l.warn("initialize",e),e instanceof X?t.notifyParentAboutModalSignIn(e):(t.restoreHash(),e instanceof G&&r.triggerOnAccessTokenHasExpired(),Promise.reject(e))},this.verifyRideErrorException=function(e){return e instanceof U&&e.jump&&h.replaceUrl(e.jump),Promise.reject(e)},this.verifyCsrfException=function(e){var r=e.type;return r&&r===A.CSRF&&t.signOut(),Promise.reject(e)},this.processTokenResponse=function(e){var r=t.adobeIdData.handlers,o=e.tokenFields,i=e.profile,n=o.tokenValue,s=o.state,a=o.expire,c=o.sid,u=o.user_id,d=o.other,p=void 0===d?{}:d,f=o.impersonatorId,v=o.isImpersonatedSession;l.info("token",n),p.from_ims&&h.setHash(p.old_hash||""),t.profileService.removeProfileIfOtherUser(u);var m={token:n,expire:a,sid:c,impersonatorId:f,isImpersonatedSession:v};return o.isReauth()?r.triggerOnReauthAccessToken(m):t.tokenReceived(m),i&&t.profileService.saveProfileToStorage(i),Promise.resolve(s)},this.exchangeIjt=function(e){var r=t.adobeIdData.ijt;return e||r?t.tokenService.exchangeIjt(e||r).then((function(e){return t.profileService.removeProfile(),Promise.resolve(e)})):Promise.reject(new Error("please set the adobeid.ijt value"))},this.adobeIdData=new O(e);var o=this.adobeIdData,i=o.api_parameters,n=void 0===i?{}:i,s=o.client_id,a=o.scope,c=o.useLocalStorage,u=o.autoValidateToken,d=o.modalMode,f=o.modalSettings;this.imsApis=new z(n),this.csrfService=new p(s),this.serviceRequest={clientId:s,scope:a,imsApis:this.imsApis},this.tokenService=new Z(r(r({},this.serviceRequest),{useLocalStorage:c,autoValidateToken:u}),this.csrfService),this.profileService=new H(this.serviceRequest),this.signInservice=d?new I(this.onPopupMessage,f):new b}return Object.defineProperty(e.prototype,"version",{get:function(){return f.jslibver},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adobeid",{get:function(){return r({},this.adobeIdData)},enumerable:!0,configurable:!0}),e.prototype.enableLogging=function(){l.enableLogging()},e.prototype.disableLogging=function(){l.disableLogging()},e.prototype.checkInitialized=function(){this.initialized},e.prototype.signUp=function(e,t){var r=this;void 0===e&&(e={}),this.checkInitialized();var o=this.adobeIdData,i=this.csrfService;if(!o)throw new Error("no adobeId on reAuthenticate");var n=i.initialize();return o.createSignUpRedirectRequest(e,t,n).then((function(e){r.signInservice.signIn(e)}))},e.prototype.isSignedInUser=function(){return!(!this.getAccessToken()&&!this.getReauthAccessToken())},e.prototype.getProfile=function(){var e=this,t=this.profileService.getProfileFromStorage();if(t)return Promise.resolve(t);var r=this.getAccessToken()||this.getReauthAccessToken();if(!r){return Promise.reject(new M("please login before getting the profile"))}return this.profileService.getProfile(r.token).then((function(e){return Promise.resolve(e)})).catch((function(t){return l.error("get profile exception ",t),t instanceof D?e.refreshToken().then((function(e){return Promise.resolve(e.profile)})):Promise.reject(new M(t.message||t))}))},e.prototype.avatarUrl=function(e){return this.imsApis.avatarUrl(e)},e.prototype.getReleaseFlags=function(){return this.tokenService.getReleaseFlags()},e.prototype.getAccessToken=function(){var e=this.tokenService.getTokenFieldsFromStorage();return e?{token:e.tokenValue,expire:e.expire,sid:e.sid}:null},e.prototype.getReauthAccessToken=function(){var e=this.tokenService.getTokenFieldsFromStorage(!0);return e?{token:e.tokenValue,expire:e.expire,sid:e.sid}:null},e.prototype.listSocialProviders=function(){var e=this;return new Promise((function(t,r){var o=e.adobeIdData.client_id;e.imsApis.listSocialProviders({client_id:o}).then((function(e){t(e)})).catch((function(e){r(e)}))}))},e.prototype.tokenReceived=function(e){this.adobeIdData.handlers.triggerOnAccessToken(e),Y.startAutoRefreshFlow({expire:e.expire,refreshTokenMethod:this.refreshToken})},e.prototype.onTokenProfileReceived=function(e){var t=e.tokenInfo,r=e.profile;return l.info("token",t),this.tokenReceived(t),this.profileService.saveProfileToStorage(r),Promise.resolve(e)},e.prototype.validateToken=function(){var e=this;return this.tokenService.validateToken().then((function(){return Promise.resolve(!0)})).catch((function(t){return l.warn("validate token exception",t),t instanceof D?Promise.reject(!1):(e.profileService.removeProfile(),Promise.reject(!1))}))},e.prototype.onTokenExpired=function(){var e=this.adobeIdData.handlers;this.tokenService.purge(),e.triggerOnAccessTokenHasExpired()},e.prototype.setStandAloneToken=function(e){return this.tokenService.setStandAloneToken(e)},e.prototype.initialize=function(){var e=this,t=this.adobeIdData,r=t.handlers,o=t.standalone,i=t.ijt,n=null;return o&&this.setStandAloneToken(o),(i?this.exchangeIjt:this.tokenService.getTokenAndProfile)().then(this.processTokenResponse,(function(t){return e.processInitializeException(t).catch((function(t){return e.verifyRideErrorException(t)})).catch((function(t){return e.verifyCsrfException(t).catch((function(e){return l.info("initialize exception ended",e)}))}))})).then((function(e){n=e})).finally((function(){return l.info("onReady initialization"),window.addEventListener("getImsLibInstance",(function(){e.triggerOnImsInstance(e)}),!1),r.triggerOnReady(n?n.context:null),e.triggerOnImsInstance(e),e.initialized=!0,Promise.resolve(n)}))},e.prototype.notifyParentAboutModalSignIn=function(e){var t=window.location.href.replace("imslibmodal","wasmodal");return window.opener?(window.opener.postMessage(t,"*"),window.close()):window[""+e.wndRedirectPropName]=t,Promise.reject("popup")},e.prototype.restoreHash=function(){var e=J.fragmentToObject();e&&e.from_ims&&h.setHash(e.old_hash||"")},e.prototype.getTransitoryAuthorizationCode=function(e,t){return void 0===t&&(t={}),(e=e||{}).response_type=e.response_type||"code",e.target_client_id=e.target_client_id||this.adobeIdData.client_id,e.target_scope=e.target_scope||this.adobeIdData.scope,this.imsApis.getTransitoryAuthorizationCode(e,t,this.adobeIdData.client_id)},e.prototype.jumpToken=function(e,t){return void 0===t&&(t={}),e.target_client_id=e.target_client_id||this.adobeIdData.client_id,e.target_scope=e.target_scope||this.adobeIdData.scope,this.imsApis.jumpToken(e,t,this.adobeIdData.client_id)},e}(),ee=new(function(){function e(){this.createIMSLib=function(e,t){void 0===e&&(e=null),void 0===t&&(t="adobeIMS");var r=new $(e);return window[t]=r,r}}return e.prototype.initAdobeIms=function(){window.adobeImsFactory={createIMSLib:this.createIMSLib};var e=window.adobeIMS||null;if(!e){var t=window.adobeid;if(!t)return;(e=this.createIMSLib(t,"adobeIMS")).initialize()}},e}());return new(function(){function e(){ee.initAdobeIms()}return e.prototype.initialize=function(){return!0},e}())}();
